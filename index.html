<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GCODE-OS</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    body, html {
      height: 100%;
      margin: 0;
    }
    #workspace {
      position: relative;
      background: #f8f9fa;
      height: calc(100vh - 56px);
      max-height: calc(100vh - 56px);
      overflow: auto;
      user-select: none;
      touch-action: none;
    }

    /* Wrap grid in a pseudo-element for animation */
    #workspace::after {
      content: "";
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.3s ease-in;
      background-image:
        linear-gradient(to right, rgba(0,0,0,0.1) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(0,0,0,0.1) 1px, transparent 1px);
      background-size: 10px 10px;
      z-index: 0;
    }

    #workspace.show-grid::after {
      z-index: 0;
      opacity: 1;
    }

    .module-card {
      position: absolute;
      background: white;
      border: 1px solid #ddd;
      border-radius: 0;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      box-shadow: 0 0 5px rgb(0 0 0 / 0.1);
      z-index: 1;
      opacity: 1;
      user-select: none;
      transition:
          opacity 0.3s ease-in,
          border-color 0.3s ease-in,
          border-width 0.3s ease-in,
          box-shadow 0.3s ease-in;
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);

    }
    .module-card.dragging {
      opacity: 0.6;
      cursor: grabbing;
      z-index: 10;
      border: 1px solid #dc3545 !important; /* Bootstrap red */
      box-shadow: 0 8px 10px rgba(0, 0, 0, 0.5); /* Stronger shadow while dragging */
    }

    .module-header {
      background-color: #ffffff;
      border-bottom: 1px solid #ccc;
      color: #000000;
      font-weight: 600;
      padding-left: 0.5rem; /* px-2 */
      padding-right: 0.5rem;
      font-size: 0.875rem; /* fs-6 */
      line-height: 22px;
      height: 22px;
      cursor: grab;
      transition:
          background-color 0.3s ease-in;
    }
    .module-body {
      padding: 0.5rem;
      flex-grow: 1;
      font-size: 0.9rem;
      overflow: auto;
      height: calc(100% - 22px);
    }

    .module-card.dragging .module-header  {
      background-color: rgba(0,0,0,0.1);
    }

    /* Standard resize handle as small triangle bottom-right */
    .resize-handle {
      position: absolute;
      width: 12px;
      height: 12px;
      right: 2px;
      bottom: 2px;
      cursor: se-resize;
      clip-path: polygon(0 100%, 100% 100%, 100% 0);
      background: #aaa;
      opacity: 0.7;
      z-index: 11;
    }
    /* show resize handle only in edit mode */
    #workspace.edit-mode .resizable .resize-handle {
      display: block;
    }
    /* Windows-style menu checkboxes */
    .dropdown-menu .form-check {
      position: relative;
      padding-left: 28px;
      margin-bottom: 0.25rem;
      user-select: none;
    }
    .navbar .dropdown-menu .form-check-input:checked {
      background-color: #6c757d; /* Bootstrap gray-600 */
      border-color: #6c757d;
    }

    .navbar .dropdown-menu .form-check-input:focus {
      box-shadow: none;
      border-color: #6c757d;
    }

  </style>
</head>
<body>

  <nav class="navbar navbar-expand-lg py-1 sticky-top border-bottom shadow-sm">
    <div class="container-fluid">
      <a class="navbar-brand small p-0 m-0 pe-3 pb-1" href="#">
        <img src="/logo.svg" alt="Logo" height="30" class="m-0">
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <a class="nav-link active" href="#"><i class="fas fa-house me-1"></i>Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#"><i class="fas fa-circle-info me-1"></i>About</a>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              <i class="fas fa-layer-group me-1"></i>Modules
            </a>
            <ul class="dropdown-menu" aria-labelledby="viewMenuButton" style="min-width: 220px;">
              <!-- Show/Hide Modules -->
              <li>
                <h6 class="dropdown-header"><i class="fas fa-eye-slash me-1"></i>Show/Hide Modules</h6>
              </li>
              <li><div id="moduleCheckboxes" class="p-0"></div></li>
              <li><hr class="dropdown-divider"></li>
              <li>
                <button id="resetPositionsBtn" class="dropdown-item">
                  <i class="fas fa-undo me-1"></i>Reset Positions to Defaults
                </button>
              </li>
              <!-- End Show/Hide Modules -->

            </ul>
          </li>
          <li class="nav-item">
            <a class="nav-link disabled" aria-disabled="true"><i class="fas fa-ban me-1"></i>Disabled</a>
          </li>
        </ul>

        <!-- Login Dropdown -->
        <div class="dropdown">
          <button class="btn btn-outline-dark btn-sm dropdown-toggle" type="button" id="loginDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="fas fa-user me-1"></i>Login
          </button>
          <div class="dropdown-menu dropdown-menu-end p-3 shadow" style="min-width: 250px;">
            <form>
              <i class="fas fa-user me-1"></i>Login
              <hr>
              <div class="mb-2">
                <label for="loginEmail" class="form-label small mb-1">Email</label>
                <input type="email" class="form-control form-control-sm" id="loginEmail" placeholder="you@example.com">
              </div>
              <div class="mb-2">
                <label for="loginPassword" class="form-label small mb-1">Password</label>
                <input type="password" class="form-control form-control-sm" id="loginPassword" placeholder="••••••••">
              </div>
              <button type="submit" class="btn btn-sm btn-primary w-100">Login</button>
            </form>
          </div>
        </div>

      </div>
    </div>
  </nav>

  <main id="workspace" tabindex="0">
    <!-- Modules injected by JS -->
  </main>

  <script type="importmap">
  {
    "imports": {
      "three": "https://cdn.jsdelivr.net/npm/three@0.161.0/build/three.module.js"
    }
  }
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/interactjs@1.10.11/dist/interact.min.js"></script>
  <script src="./modules/__module_list.js"></script>

  <script type="module">
    // import { resize } from '/modules/3dview.js';
  </script>

    <script type="module" src="./js/workspace.js"></script>

</body>
</html>
